/* fastuts.js | Developed by Guilherme Augusto Madaleno <guimadaleno@me.com> | www.guimadaleno.com | (C) 2014 All rights reserved | Licensed under GNU GPL */
$.fn.fastuts=function(e){var t={selector:$(this).selector.replace(".","").replace("#",""),settings:{allowKeys:e&&e.settings&&e.settings.allowKeys?e.settings.allowKeys:true,autoScroll:e&&e.settings&&e.settings.autoScroll?e.settings.autoScroll:true,spacing:e&&e.settings&&e.settings.spacing?e.settings.spacing:"40px",time:e&&e.settings&&e.settings.time?e.settings.time:.3,minHeight:e&&e.settings&&e.settings.minHeight?e.settings.minHeight:400},overlay:{"class":e&&e.overlay&&e.overlay.class?e.overlay.class:"fastuts-overlay",color:e&&e.overlay&&e.overlay.color?e.overlay.color:"rgba(0,0,0,0.8)",allowEscapeKey:e&&e.overlay&&e.overlay.allowEscapeKey?e.overlay.allowEscapeKey:true,onClose:e&&e.overlay&&e.overlay.onClose&&$.type(e.overlay.onClose)==="function"?e.overlay.onClose:false},buttons:{close:{"class":"fastuts-button-close",text:e&&e.buttons&&e.buttons.close&&e.buttons.close.text?e.buttons.close.text:"Close",callback:e&&e.buttons&&e.buttons.close&&e.buttons.close.callback&&$.type(e.buttons.close.callback)==="function"?e.buttons.close.callback:false},prev:{"class":"fastuts-button-prev",text:e&&e.buttons&&e.buttons.prev&&e.buttons.prev.text?e.buttons.prev.text:"&#10094;",callback:e&&e.buttons&&e.buttons.prev&&e.buttons.prev.callback&&$.type(e.buttons.prev.callback)==="function"?e.buttons.prev.callback:false},next:{"class":"fastuts-button-next",text:e&&e.buttons&&e.buttons.next&&e.buttons.next.text?e.buttons.next.text:"&#10095;",callback:e&&e.buttons&&e.buttons.next&&e.buttons.next.callback&&$.type(e.buttons.next.callback)==="function"?e.buttons.next.callback:false}},classes:{arrows:{top:"fastuts-tooltip-arrow-top",right:"fastuts-tooltip-arrow-right",bottom:"fastuts-tooltip-arrow-bottom",left:"fastuts-tooltip-arrow-left"},content:{buttons:"fastuts-buttons",holder:"fastuts-holder",text:"fastuts-text",tooltip:"fastuts-tooltip"}},attributes:{order:"data-fastuts-order",previousElPosition:"data-fastuts-previous-element-position",previousPosition:"data-fastuts-previous-position",previousZIndex:"data-fastuts-previous-zindex",tip:e&&e.attributes&&e.attributes.tip?e.attributes.tip:"data-fastuts-tip"},onReady:e&&e.onReady&&$.type(e.onReady)==="function"?e.onReady:false,holder:"fastuts-main-holder",fn:{alignTimer:false,block:false,el:this,elAttrCount:0,elCurPos:0,elHeight:"",elLeft:"",elLoc:"",elMargin:"",elNum:[],elPos:"",elSize:0,elTop:"",elWidth:"",elWindowLeft:"",elWindowRight:"",elWindowTop:"",elZIndex:0,indexTimer:false,holderCSS:false,holderIndex:1,index:0}};var n={init:function(){if($(window).height()<=t.settings.minHeight){console.log("Fastuts cannot be loaded. Mininum height of "+t.settings.minHeight+"px required.")}else{$(t.fn.el).each(function(){if($(this).hasClass(t.selector)&&$(this).attr(t.attributes.tip)){t.fn.elSize++}if($(this).attr(t.attributes.order)){t.fn.elAttrCount++}});if(t.fn.elAttrCount&&t.fn.elSize){var e=0;$(t.fn.el).each(function(){e=parseInt($(this).attr(t.attributes.order))-1;t.fn.elNum[e]=this});t.fn.el=t.fn.elNum}$("#"+t.holder).remove();$("body").append('<div id="'+t.holder+'" class="'+t.holder+'" style="display: none;"><div class="'+t.overlay.class+'"></div><div class="'+t.classes.content.holder+'"><div class="'+t.classes.content.tooltip+'"><div class="'+t.classes.content.text+'"></div><div class="'+t.classes.content.buttons+'"><a href="#" class="'+t.buttons.close.class+'">'+t.buttons.close.text+'</a><a href="#" class="'+t.buttons.prev.class+'">'+t.buttons.prev.text+'</a><a href="#" class="'+t.buttons.next.class+'">'+t.buttons.next.text+"</a></div></div></div></div>");if(t.fn.elSize){if($(t.fn.el[t.fn.holderIndex-1]).attr(t.attributes.tip)&&$(t.fn.el[t.fn.holderIndex-1]).hasClass(t.selector)){n.displayBlock(t.fn.el[t.fn.holderIndex-1]);n.displayButtons(1,t.fn.elSize);if(t.onReady){t.onReady()}$("."+t.buttons.prev.class).off("click").on("click",function(){n.prevBlock(function(){if(t.buttons.prev.callback){t.buttons.prev.callback(t.fn.index,t.fn.el)}});return false});$("."+t.buttons.next.class).off("click").on("click",function(){n.nextBlock(function(){if(t.buttons.next.callback){t.buttons.next.callback(t.fn.index,t.fn.el)}});return false});if(t.settings.allowKeys==true){$(document).keyup(function(e){if(e.keyCode==37){n.prevBlock(function(){if(t.buttons.prev.callback){t.buttons.prev.callback(t.fn.index,t.fn.el)}return false})}else if(e.keyCode==39){n.nextBlock(function(){if(t.buttons.next.callback){t.buttons.next.callback(t.fn.index,t.fn.el)}return false})}})}$("."+t.buttons.close.class).off("click").on("click",function(e){if(t.buttons.close.callback&&t.buttons.close.callback()){n.hide();return false}else{n.hide();return false}});if(t.overlay.allowEscapeKey==true){$(document).keyup(function(e){if(e.keyCode==27){if(t.overlay.onClose){t.overlay.onClose()}n.hide()}})}$("."+t.overlay.class).off("click").on("click",function(){if(t.overlay.onClose){t.overlay.onClose()}n.hide();return false});$("#"+t.holder).fadeIn(200)}}}},displayBlock:function(n){if($(n).html()&&$(n).hasClass(t.selector)&&$(n).attr(t.attributes.tip)){t.fn.elLoc=$(n).offset();t.fn.elPos=$(n).css("position");t.fn.elMargin=t.settings.spacing&&t.settings.spacing.indexOf()==-1?parseInt(t.settings.spacing.replace("px","")):40;t.fn.elWidth=parseInt($(n).css("width").replace("px",""))+t.fn.elMargin;t.fn.elHeight=parseInt($(n).css("height").replace("px",""))+t.fn.elMargin;t.fn.elTop=t.fn.elLoc.top-t.fn.elMargin/2;t.fn.elLeft=t.fn.elLoc.left-t.fn.elMargin/2;t.fn.elWindowTop=t.fn.elTop+t.fn.elHeight;t.fn.elWindowRight=t.fn.elLeft+t.fn.elWidth;t.fn.elWindowLeft=t.fn.elLeft;t.fn.alignTimer;t.fn.holderCSS={position:"absolute",width:t.fn.elWidth+"px",height:t.fn.elHeight+"px",top:t.fn.elTop+"px",left:t.fn.elLeft+"px",webkitTransition:"all "+t.settings.time+"s",transition:"all "+t.settings.time+"s",backgroundColor:$("body").css("backgroundColor")?$("body").css("backgroundColor"):"#FFFFFF"};$("*").filter(function(){if($(this).css("position")=="fixed"){$(this).attr(t.attributes.previousPosition,"fixed");$(this).css("position","absolute")}});$("."+t.classes.content.tooltip).children("."+t.classes.content.text).html($(n).attr(t.attributes.tip));$(t.fn.el).each(function(){if($(this).attr(t.attributes.previousZIndex)){$(this).css("z-index",$(this).attr(t.attributes.previousZIndex))}});t.fn.elZIndex=$(n).css("z-index");t.fn.elCurPos=$(n).css("position");if(!$(n).attr(t.attributes.previousZIndex)){$(n).attr(t.attributes.previousZIndex,t.fn.elZIndex)}if(!$(n).attr(t.attributes.previousElPosition)){$(n).attr(t.attributes.previousElPosition,t.fn.elCurPos)}if(t.fn.indexTimer){clearTimeout(t.fn.indexTimer)}t.fn.indexTimer=setTimeout(function(){$(n).css({zIndex:"2147483637",position:t.fn.elCurPos==="static"?"relative":t.fn.elCurPos}).hide().fadeIn(200)},t.settings.time*750);$("."+t.overlay.class).css({position:"fixed",left:"0px",top:"0px",right:"0px",bottom:"0px",backgroundColor:t.overlay.color?t.overlay.color:"rgba(0,0,0,0.8)"});$("."+t.holder).css({position:"absolute",left:"0px",top:"0px",right:"0px",bottom:"0px"});if(t.fn.elWindowTop>=$(window).height()-200){$("."+t.classes.content.tooltip).removeClass(t.classes.arrows.top).addClass(t.classes.arrows.bottom).css({top:"-"+($("."+t.classes.content.tooltip).height()+20)+"px"});if(t.settings.autoScroll){$("html, body").clearQueue().animate({scrollTop:t.fn.elTop-($("."+t.classes.content.tooltip).height()+40)},500)}}else{$("."+t.classes.content.tooltip).removeClass(t.classes.arrows.bottom).addClass(t.classes.arrows.top).css({top:t.fn.elHeight+20+"px"});if(t.settings.autoScroll){$("html, body").clearQueue().animate({scrollTop:t.fn.elTop-20},500)}}if(t.fn.elWindowLeft<=100){$("."+t.classes.content.tooltip).removeClass(t.classes.arrows.right).addClass(t.classes.arrows.left).css({left:"0px",right:"auto",marginLeft:"inherit"})}else if(t.fn.elWindowRight>=$(window).width()-100){$("."+t.classes.content.tooltip).removeClass(t.classes.arrows.left).addClass(t.classes.arrows.right).css({left:"auto",right:"0px",marginRight:"inherit"})}else{$("."+t.classes.content.tooltip).removeClass(t.classes.arrows.left).removeClass(t.classes.arrows.right).css({left:"50%",right:"auto",marginLeft:"-"+$("."+t.classes.content.tooltip).width()/2+"px",marginRight:"auto"})}$("."+t.classes.content.holder).css(t.fn.holderCSS);$("html, body").css("overflow","hidden");$(window).bind("resize",function(){if(t.fn.alignTimer)clearTimeout(t.fn.alignTimer);t.fn.alignTimer=setTimeout(function(){t.fn.elLoc=$(n).offset();t.fn.elTop=t.fn.elLoc.top-t.fn.elMargin/2;t.fn.elLeft=t.fn.elLoc.left-t.fn.elMargin/2;t.fn.elWindowTop=t.fn.elTop+t.fn.elHeight;$("."+t.classes.content.holder).css({position:"absolute",width:t.fn.elWidth+"px",height:t.fn.elHeight+"px",top:t.fn.elTop+"px",left:t.fn.elLeft+"px",webkitTransition:e&&t.settings.time?"all "+t.settings.time+"s":"all 0.2s",transition:e&&t.settings.time?"all "+t.settings.time+"s":"all 0.2s",backgroundColor:$("body").css("backgroundColor")?$("body").css("backgroundColor"):"#FFFFFF"})},300)})}},displayButtons:function(e,n){if(e==1&&t.fn.el.length>1){$("."+t.buttons.prev.class).hide();$("."+t.buttons.next.class).fadeIn(100)}else if(e==1&&t.fn.el.length<=1){$("."+t.buttons.prev.class).hide();$("."+t.buttons.next.class).hide()}else if(e==n){$("."+t.buttons.prev.class).fadeIn(100);$("."+t.buttons.next.class).hide()}else{$("."+t.buttons.prev.class).fadeIn(100);$("."+t.buttons.next.class).fadeIn(100)}},hide:function(){$("."+t.holder).fadeOut(100,function(){t.fn.holderIndex=1;t.fn.index=0});$(t.fn.el).css("z-index",t.fn.elZIndex);$("*["+t.attributes.previousPosition+'="fixed"]').filter(function(){if($(this).attr(t.attributes.previousPosition)==="fixed"){$(this).removeAttr(t.attributes.previousPosition);$(this).css("position","fixed")}});$("*["+t.attributes.previousElPosition+"]").filter(function(){$(this).css("position",$(this).attr(t.attributes.previousElPosition));$(this).removeAttr(t.attributes.previousElPosition)});$("html, body").css("overflow","auto")},nextBlock:function(e){if(t.fn.holderIndex<t.fn.elSize){t.fn.index=t.fn.holderIndex=t.fn.holderIndex+1;n.displayBlock(t.fn.el[t.fn.holderIndex-1]);n.displayButtons(t.fn.index,t.fn.elSize);e()}},prevBlock:function(e){if(t.fn.holderIndex>1){t.fn.index=t.fn.holderIndex=t.fn.holderIndex-1;n.displayBlock(t.fn.el[t.fn.holderIndex-1]);n.displayButtons(t.fn.index,t.fn.elSize);e()}}};n.init()}